function style(el, value) {
    el.style['transform'] = value;
    el.style['webkitTransform'] = value;
}
const ripple = {
    show(e, el, value = {}) {
        if (!el._ripple || !el._ripple.enabled) {
            return;
        }
        const container = document.createElement('span');
        const animation = document.createElement('span');
        container.appendChild(animation);
        container.className = 'v-ripple__container';
        if (value.class) {
            container.className += ` ${value.class}`;
        }
        const size = (Math.min(el.clientWidth, el.clientHeight) *
            (value.center ? 1 : el.clientWidth / el.clientHeight * 1.6));
        const halfSize = size / 2;
        animation.className = 'v-ripple__animation';
        animation.style.width = `${size}px`;
        animation.style.height = `${size}px`;
        el.appendChild(container);
        const computed = window.getComputedStyle(el);
        if (computed.position !== 'absolute' && computed.position !== 'fixed')
            el.style.position = 'relative';
        const offset = el.getBoundingClientRect();
        const x = value.center ? 0 : e.clientX - offset.left - halfSize;
        const y = value.center ? 0 : e.clientY - offset.top - halfSize;
        animation.classList.add('v-ripple__animation--enter');
        animation.classList.add('v-ripple__animation--visible');
        style(animation, `translate(${x}px, ${y}px) scale3d(0.5, 0.5, 0.5)`);
        animation.dataset.activated = String(performance.now());
        setTimeout(() => {
            animation.classList.remove('v-ripple__animation--enter');
            style(animation, `translate(${x}px, ${y}px)  scale3d(1, 1, 1)`);
        }, 0);
    },
    hide(el) {
        if (!el || !el._ripple || !el._ripple.enabled)
            return;
        const ripples = el.getElementsByClassName('v-ripple__animation');
        if (ripples.length === 0)
            return;
        const animation = ripples[ripples.length - 1];
        if (animation.dataset.isHiding)
            return;
        else
            animation.dataset.isHiding = 'true';
        const diff = performance.now() - Number(animation.dataset.activated);
        const delay = Math.max(300 - diff, 0);
        setTimeout(() => {
            animation.classList.remove('v-ripple__animation--visible');
            setTimeout(() => {
                const ripples = el.getElementsByClassName('v-ripple__animation');
                if (ripples.length === 0)
                    el.style.position = null;
                animation.parentNode && el.removeChild(animation.parentNode);
            }, 300);
        }, delay);
    }
};
function isRippleEnabled(value) {
    return typeof value === 'undefined' || !!value;
}
function rippleShow(e) {
    const value = {};
    const element = e.currentTarget;
    if (!element)
        return;
    value.center = element._ripple.centered;
    if (element._ripple.class) {
        value.class = element._ripple.class;
    }
    ripple.show(e, element, value);
}
function rippleHide(e) {
    ripple.hide(e.currentTarget);
}
function updateRipple(el, binding, wasEnabled) {
    const enabled = isRippleEnabled(binding.value);
    if (!enabled) {
        ripple.hide(el);
    }
    el._ripple = el._ripple || {};
    el._ripple.enabled = enabled;
    const value = binding.value || {};
    if (value.center) {
        el._ripple.centered = true;
    }
    if (value.class) {
        el._ripple.class = binding.value.class;
    }
    if (enabled && !wasEnabled) {
        if ('ontouchstart' in window) {
            el.addEventListener('touchend', rippleHide, false);
            el.addEventListener('touchcancel', rippleHide, false);
        }
        el.addEventListener('mousedown', rippleShow, false);
        el.addEventListener('mouseup', rippleHide, false);
        el.addEventListener('mouseleave', rippleHide, false);
        // Anchor tags can be dragged, causes other hides to fail - #1537
        el.addEventListener('dragstart', rippleHide, false);
    }
    else if (!enabled && wasEnabled) {
        removeListeners(el);
    }
}
function removeListeners(el) {
    el.removeEventListener('mousedown', rippleShow, false);
    el.removeEventListener('touchend', rippleHide, false);
    el.removeEventListener('touchcancel', rippleHide, false);
    el.removeEventListener('mouseup', rippleHide, false);
    el.removeEventListener('mouseleave', rippleHide, false);
    el.removeEventListener('dragstart', rippleHide, false);
}
function directive(el, binding) {
    updateRipple(el, binding, false);
}
function unbind(el) {
    delete el._ripple;
    removeListeners(el);
}
function update(el, binding) {
    if (binding.value === binding.oldValue) {
        return;
    }
    const wasEnabled = isRippleEnabled(binding.oldValue);
    updateRipple(el, binding, wasEnabled);
}
export default {
    name: 'ripple',
    bind: directive,
    unbind,
    update
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmlwcGxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2RpcmVjdGl2ZXMvcmlwcGxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLFNBQVMsS0FBSyxDQUFFLEVBQWUsRUFBRSxLQUFhO0lBQzVDLEVBQUUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEdBQUcsS0FBSyxDQUFBO0lBQzdCLEVBQUUsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsR0FBRyxLQUFLLENBQUE7QUFDckMsQ0FBQztBQXFCRCxNQUFNLE1BQU0sR0FBRztJQUNiLElBQUksQ0FBRSxDQUFhLEVBQUUsRUFBZSxFQUFFLFFBQXVCLEVBQUU7UUFDN0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRTtZQUN0QyxPQUFNO1NBQ1A7UUFFRCxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ2hELE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUE7UUFFaEQsU0FBUyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUNoQyxTQUFTLENBQUMsU0FBUyxHQUFHLHFCQUFxQixDQUFBO1FBRTNDLElBQUksS0FBSyxDQUFDLEtBQUssRUFBRTtZQUNmLFNBQVMsQ0FBQyxTQUFTLElBQUksSUFBSSxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUE7U0FDekM7UUFFRCxNQUFNLElBQUksR0FBRyxDQUNYLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUMsWUFBWSxDQUFDO1lBQ3pDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLENB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O0FBRUQsZUFBZTtJQUNiLElBQUksRUFBRSxRQUFRO0lBQ2QsSUFBSSxFQUFFLFNBQVM7SUFDZixNQUFNO0lBQ04sTUFBTTtDQUNQLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWTm9kZURpcmVjdGl2ZSB9IGZyb20gJ3Z1ZSdcblxuZnVuY3Rpb24gc3R5bGUgKGVsOiBIVE1MRWxlbWVudCwgdmFsdWU6IHN0cmluZykge1xuICBlbC5zdHlsZVsndHJhbnNmb3JtJ10gPSB2YWx1ZVxuICBlbC5zdHlsZVsnd2Via2l0VHJhbnNmb3JtJ10gPSB2YWx1ZVxufVxuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIGludGVyZmFjZSBFbGVtZW50IHtcbiAgICBnZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZXM6IHN0cmluZyk6IE5vZGVMaXN0T2Y8SFRNTEVsZW1lbnQ+XG4gIH1cblxuICBpbnRlcmZhY2UgSFRNTEVsZW1lbnQge1xuICAgIF9yaXBwbGU6IHVuZGVmaW5lZCB8IHtcbiAgICAgIGVuYWJsZWQ/OiBib29sZWFuXG4gICAgICBjZW50ZXJlZD86IGJvb2xlYW5cbiAgICAgIGNsYXNzPzogc3RyaW5nXG4gICAgfVxuICB9XG59XG5cbmludGVyZmFjZSBSaXBwbGVPcHRpb25zIHtcbiAgY2xhc3M/OiBzdHJpbmdcbiAgY2VudGVyPzogYm9vbGVhblxufVxuXG5jb25zdCByaXBwbGUgPSB7XG4gIHNob3cgKGU6IE1vdXNlRXZlbnQsIGVsOiBIVE1MRWxlbWVudCwgdmFsdWU6IFJpcHBsZU9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghZWwuX3JpcHBsZSB8fCAhZWwuX3JpcHBsZS5lbmFibGVkKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJylcbiAgICBjb25zdCBhbmltYXRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJylcblxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChhbmltYXRpb24pXG4gICAgY29udGFpbmVyLmNsYXNzTmFtZSA9ICd2LXJpcHBsZV9fY29udGFpbmVyJ1xuXG4gICAgaWYgKHZhbHVlLmNsYXNzKSB7XG4gICAgICBjb250YWluZXIuY2xhc3NOYW1lICs9IGAgJHt2YWx1ZS5jbGFzc31gXG4gICAgfVxuXG4gICAgY29uc3Qgc2l6ZSA9IChcbiAgICAgIE1hdGgubWluKGVsLmNsaWVudFdpZHRoLCBlbC5jbGllbnRIZWlnaHQpICpcbiAgICAgICh2YWx1ZS5jZW50ZXIgPyAxIDogZWwuY2xpZW50V2lkdGggLyBlbC5jbGllbnRIZWlnaHQgKiAxLjYpXG4gICAgKVxuICAgIGNvbnN0IGhhbGZTaXplID0gc2l6ZSAvIDJcbiAgICBhbmltYXRpb24uY2xhc3NOYW1lID0gJ3YtcmlwcGxlX19hbmltYXRpb24nXG4gICAgYW5pbWF0aW9uLnN0eWxlLndpZHRoID0gYCR7c2l6ZX1weGBcbiAgICBhbmltYXRpb24uc3R5bGUuaGVpZ2h0ID0gYCR7c2l6ZX1weGBcblxuICAgIGVsLmFwcGVuZENoaWxkKGNvbnRhaW5lcilcbiAgICBjb25zdCBjb21wdXRlZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKVxuICAgIGlmIChjb21wdXRlZC5wb3NpdGlvbiAhPT0gJ2Fic29sdXRlJyAmJiBjb21wdXRlZC5wb3NpdGlvbiAhPT0gJ2ZpeGVkJykgZWwuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnXG5cbiAgICBjb25zdCBvZmZzZXQgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgIGNvbnN0IHggPSB2YWx1ZS5jZW50ZXIgPyAwIDogZS5jbGllbnRYIC0gb2Zmc2V0LmxlZnQgLSBoYWxmU2l6ZVxuICAgIGNvbnN0IHkgPSB2YWx1ZS5jZW50ZXIgPyAwIDogZS5jbGllbnRZIC0gb2Zmc2V0LnRvcCAtIGhhbGZTaXplXG5cbiAgICBhbmltYXRpb24uY2xhc3NMaXN0LmFkZCgndi1yaXBwbGVfX2FuaW1hdGlvbi0tZW50ZXInKVxuICAgIGFuaW1hdGlvbi5jbGFzc0xpc3QuYWRkKCd2LXJpcHBsZV9fYW5pbWF0aW9uLS12aXNpYmxlJylcbiAgICBzdHlsZShhbmltYXRpb24sIGB0cmFuc2xhdGUoJHt4fXB4LCAke3l9cHgpIHNjYWxlM2QoMC41LCAwLjUsIDAuNSlgKVxuICAgIGFuaW1hdGlvbi5kYXRhc2V0LmFjdGl2YXRlZCA9IFN0cmluZyhwZXJmb3JtYW5jZS5ub3coKSlcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgYW5pbWF0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ3YtcmlwcGxlX19hbmltYXRpb24tLWVudGVyJylcbiAgICAgIHN0eWxlKGFuaW1hdGlvbiwgYHRyYW5zbGF0ZSgke3h9cHgsICR7eX1weCkgIHNjYWxlM2QoMSwgMSwgMSlgKVxuICAgIH0sIDApXG4gIH0sXG5cbiAgaGlkZSAoZWw6IEhUTUxFbGVtZW50IHwgbnVsbCkge1xuICAgIGlmICghZWwgfHwgIWVsLl9yaXBwbGUgfHwgIWVsLl9yaXBwbGUuZW5hYmxlZCkgcmV0dXJuXG5cbiAgICBjb25zdCByaXBwbGVzID0gZWwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndi1yaXBwbGVfX2FuaW1hdGlvbicpXG5cbiAgICBpZiAocmlwcGxlcy5sZW5ndGggPT09IDApIHJldHVyblxuICAgIGNvbnN0IGFuaW1hdGlvbiA9IHJpcHBsZXNbcmlwcGxlcy5sZW5ndGggLSAxXVxuXG4gICAgaWYgKGFuaW1hdGlvbi5kYXRhc2V0LmlzSGlkaW5nKSByZXR1cm5cbiAgICBlbHNlIGFuaW1hdGlvbi5kYXRhc2V0LmlzSGlkaW5nID0gJ3RydWUnXG5cbiAgICBjb25zdCBkaWZmID0gcGVyZm9ybWFuY2Uubm93KCkgLSBOdW1iZXIoYW5pbWF0aW9uLmRhdGFzZXQuYWN0aXZhdGVkKVxuICAgIGNvbnN0IGRlbGF5ID0gTWF0aC5tYXgoMzAwIC0gZGlmZiwgMClcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgYW5pbWF0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ3YtcmlwcGxlX19hbmltYXRpb24tLXZpc2libGUnKVxuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3QgcmlwcGxlcyA9IGVsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3YtcmlwcGxlX19hbmltYXRpb24nKVxuICAgICAgICBpZiAocmlwcGxlcy5sZW5ndGggPT09IDApIGVsLnN0eWxlLnBvc2l0aW9uID0gbnVsbFxuICAgICAgICBhbmltYXRpb24ucGFyZW50Tm9kZSAmJiBlbC5yZW1vdmVDaGlsZChhbmltYXRpb24ucGFyZW50Tm9kZSlcbiAgICAgIH0sIDMwMClcbiAgICB9LCBkZWxheSlcbiAgfVxufVxuXG5mdW5jdGlvbiBpc1JpcHBsZUVuYWJsZWQgKHZhbHVlOiBhbnkpOiB2YWx1ZSBpcyB0cnVlIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgISF2YWx1ZVxufVxuXG5mdW5jdGlvbiByaXBwbGVTaG93IChlOiBNb3VzZUV2ZW50KSB7XG4gIGNvbnN0IHZhbHVlOiBSaXBwbGVPcHRpb25zID0ge31cbiAgY29uc3QgZWxlbWVudCA9IGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudFxuICBpZiAoIWVsZW1lbnQpIHJldHVyblxuICB2YWx1ZS5jZW50ZXIgPSBlbGVtZW50Ll9yaXBwbGUhLmNlbnRlcmVkXG4gIGlmIChlbGVtZW50Ll9yaXBwbGUhLmNsYXNzKSB7XG4gICAgdmFsdWUuY2xhc3MgPSBlbGVtZW50Ll9yaXBwbGUhLmNsYXNzXG4gIH1cbiAgcmlwcGxlLnNob3coZSwgZWxlbWVudCwgdmFsdWUpXG59XG5cbmZ1bmN0aW9uIHJpcHBsZUhpZGUgKGU6IEV2ZW50KSB7XG4gIHJpcHBsZS5oaWRlKGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudCB8IG51bGwpXG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVJpcHBsZSAoZWw6IEhUTUxFbGVtZW50LCBiaW5kaW5nOiBWTm9kZURpcmVjdGl2ZSwgd2FzRW5hYmxlZDogYm9vbGVhbikge1xuICBjb25zdCBlbmFibGVkID0gaXNSaXBwbGVFbmFibGVkKGJpbmRpbmcudmFsdWUpXG4gIGlmICghZW5hYmxlZCkge1xuICAgIHJpcHBsZS5oaWRlKGVsKVxuICB9XG4gIGVsLl9yaXBwbGUgPSBlbC5fcmlwcGxlIHx8IHt9XG4gIGVsLl9yaXBwbGUuZW5hYmxlZCA9IGVuYWJsZWRcbiAgY29uc3QgdmFsdWUgPSBiaW5kaW5nLnZhbHVlIHx8IHt9XG4gIGlmICh2YWx1ZS5jZW50ZXIpIHtcbiAgICBlbC5fcmlwcGxlLmNlbnRlcmVkID0gdHJ1ZVxuICB9XG4gIGlmICh2YWx1ZS5jbGFzcykge1xuICAgIGVsLl9yaXBwbGUuY2xhc3MgPSBiaW5kaW5nLnZhbHVlLmNsYXNzXG4gIH1cbiAgaWYgKGVuYWJsZWQgJiYgIXdhc0VuYWJsZWQpIHtcbiAgICBpZiAoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KSB7XG4gICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHJpcHBsZUhpZGUsIGZhbHNlKVxuICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLCByaXBwbGVIaWRlLCBmYWxzZSlcbiAgICB9XG5cbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCByaXBwbGVTaG93LCBmYWxzZSlcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgcmlwcGxlSGlkZSwgZmFsc2UpXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIHJpcHBsZUhpZGUsIGZhbHNlKVxuICAgIC8vIEFuY2hvciB0YWdzIGNhbiBiZSBkcmFnZ2VkLCBjYXVzZXMgb3RoZXIgaGlkZXMgdG8gZmFpbCAtICMxNTM3XG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgcmlwcGxlSGlkZSwgZmFsc2UpXG4gIH0gZWxzZSBpZiAoIWVuYWJsZWQgJiYgd2FzRW5hYmxlZCkge1xuICAgIHJlbW92ZUxpc3RlbmVycyhlbClcbiAgfVxufVxuXG5mdW5jdGlvbiByZW1vdmVMaXN0ZW5lcnMgKGVsOiBIVE1MRWxlbWVudCkge1xuICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCByaXBwbGVTaG93LCBmYWxzZSlcbiAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCByaXBwbGVIaWRlLCBmYWxzZSlcbiAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLCByaXBwbGVIaWRlLCBmYWxzZSlcbiAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHJpcHBsZUhpZGUsIGZhbHNlKVxuICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgcmlwcGxlSGlkZSwgZmFsc2UpXG4gIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHJpcHBsZUhpZGUsIGZhbHNlKVxufVxuXG5mdW5jdGlvbiBkaXJlY3RpdmUgKGVsOiBIVE1MRWxlbWVudCwgYmluZGluZzogVk5vZGVEaXJlY3RpdmUpIHtcbiAgdXBkYXRlUmlwcGxlKGVsLCBiaW5kaW5nLCBmYWxzZSlcbn1cblxuZnVuY3Rpb24gdW5iaW5kIChlbDogSFRNTEVsZW1lbnQpIHtcbiAgZGVsZXRlIGVsLl9yaXBwbGVcbiAgcmVtb3ZlTGlzdGVuZXJzKGVsKVxufVxuXG5mdW5jdGlvbiB1cGRhdGUgKGVsOiBIVE1MRWxlbWVudCwgYmluZGluZzogVk5vZGVEaXJlY3RpdmUpIHtcbiAgaWYgKGJpbmRpbmcudmFsdWUgPT09IGJpbmRpbmcub2xkVmFsdWUpIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIGNvbnN0IHdhc0VuYWJsZWQgPSBpc1JpcHBsZUVuYWJsZWQoYmluZGluZy5vbGRWYWx1ZSlcbiAgdXBkYXRlUmlwcGxlKGVsLCBiaW5kaW5nLCB3YXNFbmFibGVkKVxufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIG5hbWU6ICdyaXBwbGUnLFxuICBiaW5kOiBkaXJlY3RpdmUsXG4gIHVuYmluZCxcbiAgdXBkYXRlXG59XG4iXX0=