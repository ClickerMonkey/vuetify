// Mixins
import CalendarBase from './calendar-base';
// Util
import { validateNumber } from '../util/validate';
import { copyTimestamp, updateMinutes, createDayList, createIntervalList, createNativeLocaleFormatter } from '../util/timestamp';
/* @vue/component */
export default CalendarBase.extend({
    name: 'calendar-with-intervals',
    // depends on: maxDays
    props: {
        maxDays: {
            type: Number,
            default: 7
        },
        shortIntervals: {
            type: Boolean,
            default: true
        },
        intervalHeight: {
            type: [Number, String],
            default: 40,
            validate: validateNumber
        },
        intervalMinutes: {
            type: [Number, String],
            default: 60,
            validate: validateNumber
        },
        firstInterval: {
            type: [Number, String],
            default: 0,
            validate: validateNumber
        },
        intervalCount: {
            type: [Number, String],
            default: 24,
            validate: validateNumber
        },
        intervalFormat: {
            type: Function,
            default: null
        },
        intervalStyle: {
            type: Function,
            default: null
        },
        showIntervalLabel: {
            type: Function,
            default: null
        }
    },
    computed: {
        parsedFirstInterval() {
            return parseInt(this.firstInterval);
        },
        parsedIntervalMinutes() {
            return parseInt(this.intervalMinutes);
        },
        parsedIntervalCount() {
            return parseInt(this.intervalCount);
        },
        parsedIntervalHeight() {
            return parseFloat(this.intervalHeight);
        },
        firstMinute() {
            return this.parsedFirstInterval * this.parsedIntervalMinutes;
        },
        bodyHeight() {
            return this.parsedIntervalCount * this.parsedIntervalHeight;
        },
        days() {
            return createDayList(this.parsedStart, this.parsedEnd, this.times.today, this.weekdaySkips, this.maxDays);
        },
        intervals() {
            const days = this.days;
            const first = this.parsedFirstInterval;
            const minutes = this.parsedIntervalMinutes;
            const count = this.parsedIntervalCount;
            const now = this.times.now;
            return days.map(d => createIntervalList(d, first, minutes, count, now));
        },
        intervalFormatter() {
            if (this.intervalFormat) {
                return this.intervalFormat;
            }
            const longOptions = { timeZone: 'UTC', hour12: true, hour: '2-digit', minute: '2-digit' };
            const shortOptions = { timeZone: 'UTC', hour12: true, hour: 'numeric', minute: '2-digit' };
            const shortHourOptions = { timeZone: 'UTC', hour12: true, hour: 'numeric' };
            return createNativeLocaleFormatter(this.locale, (tms, short) => short ? (tms.minute === 0 ? shortHourOptions : shortOptions) : longOptions);
        }
    },
    methods: {
        showIntervalLabelDefault(interval) {
            const first = this.intervals[0][0];
            const isFirst = first.hour === interval.hour && first.minute === interval.minute;
            return !isFirst && interval.minute === 0;
        },
        intervalStyleDefault(interval) {
            return undefined;
        },
        getTimestampAtEvent(e, day) {
            const timestamp = copyTimestamp(day);
            const bounds = e.currentTarget.getBoundingClientRect();
            const baseMinutes = this.firstMinute;
            const touchEvent = e;
            const mouseEvent = e;
            const touches = touchEvent.changedTouches || touchEvent.touches;
            const clientY = touches && touches[0] ? touches[0].clientY : mouseEvent.clientY;
            const addIntervals = (clientY - bounds.top) / this.parsedIntervalHeight;
            const addMinutes = Math.floor(addIntervals * this.parsedIntervalMinutes);
            const minutes = baseMinutes + addMinutes;
            return updateMinutes(timestamp, minutes, this.times.now);
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItd2l0aC1pbnRlcnZhbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WQ2FsZW5kYXIvbWl4aW5zL2NhbGVuZGFyLXdpdGgtaW50ZXJ2YWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLFNBQVM7QUFDVCxPQUFPLFlBQVksTUFBTSxpQkFBaUIsQ0FBQTtBQUUxQyxPQUFPO0FBQ1AsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFBO0FBQ2pELE9BQU8sRUFHTCxhQUFhLEVBQ2IsYUFBYSxFQUNiLGFBQWEsRUFDYixrQkFBa0IsRUFDbEIsMkJBQTJCLEVBQzVCLE1BQU0sbUJBQW1CLENBQUE7QUFFMUIsb0JBQW9CO0FBQ3BCLGVBQWUsWUFBWSxDQUFDLE1BQU0sQ0FBQztJQUNqQyxJQUFJLEVBQUUseUJBQXlCO0lBRS9CLHNCQUFzQjtJQUV0QixLQUFLLEVBQUU7UUFDTCxPQUFPLEVBQUU7WUFDUCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFDRCxjQUFjLEVBQUU7WUFDZCxJQUFJLEVBQUUsT0FBTztZQUNiLE9BQU8sRUFBRSxJQUFJO1NBQ2Q7UUFDRCxjQUFjLEVBQUU7WUFDZCxJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1lBQ3RCLE9BQU8sRUFBRSxFQUFFO1lBQ1gsUUFBUSxFQUFFLGNBQWM7U0FDekI7UUFDRCxlQUFlLEVBQUU7WUFDZixJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1lBQ3RCLE9BQU8sRUFBRSxFQUFFO1lBQ1gsUUFBUSxFQUFFLGNBQWM7U0FDekI7UUFDRCxhQUFhLEVBQUU7WUFDYixJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1lBQ3RCLE9BQU8sRUFBRSxDQUFDO1lBQ1YsUUFBUSxFQUFFLGNBQWM7U0FDekI7UUFDRCxhQUFhLEVBQUU7WUFDYixJ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QUMvRSxNQUFNLFVBQVUsR0FBVyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQTtZQUNoRixNQUFNLE9BQU8sR0FBVyxXQUFXLEdBQUcsVUFBVSxDQUFBO1lBRWhELE9BQU8sYUFBYSxDQUFDLFNBQVMsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUMxRCxDQUFDO0tBQ0Y7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8vIE1peGluc1xuaW1wb3J0IENhbGVuZGFyQmFzZSBmcm9tICcuL2NhbGVuZGFyLWJhc2UnXG5cbi8vIFV0aWxcbmltcG9ydCB7IHZhbGlkYXRlTnVtYmVyIH0gZnJvbSAnLi4vdXRpbC92YWxpZGF0ZSdcbmltcG9ydCB7XG4gIFZUaW1lc3RhbXAsXG4gIFZUaW1lc3RhbXBGb3JtYXR0ZXIsXG4gIGNvcHlUaW1lc3RhbXAsXG4gIHVwZGF0ZU1pbnV0ZXMsXG4gIGNyZWF0ZURheUxpc3QsXG4gIGNyZWF0ZUludGVydmFsTGlzdCxcbiAgY3JlYXRlTmF0aXZlTG9jYWxlRm9ybWF0dGVyXG59IGZyb20gJy4uL3V0aWwvdGltZXN0YW1wJ1xuXG4vKiBAdnVlL2NvbXBvbmVudCAqL1xuZXhwb3J0IGRlZmF1bHQgQ2FsZW5kYXJCYXNlLmV4dGVuZCh7XG4gIG5hbWU6ICdjYWxlbmRhci13aXRoLWludGVydmFscycsXG5cbiAgLy8gZGVwZW5kcyBvbjogbWF4RGF5c1xuXG4gIHByb3BzOiB7XG4gICAgbWF4RGF5czoge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgZGVmYXVsdDogN1xuICAgIH0sXG4gICAgc2hvcnRJbnRlcnZhbHM6IHtcbiAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICBkZWZhdWx0OiB0cnVlXG4gICAgfSxcbiAgICBpbnRlcnZhbEhlaWdodDoge1xuICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXSxcbiAgICAgIGRlZmF1bHQ6IDQwLFxuICAgICAgdmFsaWRhdGU6IHZhbGlkYXRlTnVtYmVyXG4gICAgfSxcbiAgICBpbnRlcnZhbE1pbnV0ZXM6IHtcbiAgICAgIHR5cGU6IFtOdW1iZXIsIFN0cmluZ10sXG4gICAgICBkZWZhdWx0OiA2MCxcbiAgICAgIHZhbGlkYXRlOiB2YWxpZGF0ZU51bWJlclxuICAgIH0sXG4gICAgZmlyc3RJbnRlcnZhbDoge1xuICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXSxcbiAgICAgIGRlZmF1bHQ6IDAsXG4gICAgICB2YWxpZGF0ZTogdmFsaWRhdGVOdW1iZXJcbiAgICB9LFxuICAgIGludGVydmFsQ291bnQ6IHtcbiAgICAgIHR5cGU6IFtOdW1iZXIsIFN0cmluZ10sXG4gICAgICBkZWZhdWx0OiAyNCxcbiAgICAgIHZhbGlkYXRlOiB2YWxpZGF0ZU51bWJlclxuICAgIH0sXG4gICAgaW50ZXJ2YWxGb3JtYXQ6IHtcbiAgICAgIHR5cGU6IEZ1bmN0aW9uLCAvLyBWVGltZXN0YW1wRm9ybWF0dGVyPHN0cmluZz4sXG4gICAgICBkZWZhdWx0OiBudWxsXG4gICAgfSxcbiAgICBpbnRlcnZhbFN0eWxlOiB7XG4gICAgICB0eXBlOiBGdW5jdGlvbiwgLy8gKGludGVydmFsOiBWVGltZXN0YW1wKTogb2JqZWN0XG4gICAgICBkZWZhdWx0OiBudWxsXG4gICAgfSxcbiAgICBzaG93SW50ZXJ2YWxMYWJlbDoge1xuICAgICAgdHlwZTogRnVuY3Rpb24sIC8vIChpbnRlcnZhbDogVlRpbWVzdGFtcCk6IGJvb2xlYW5cbiAgICAgIGRlZmF1bHQ6IG51bGxcbiAgICB9XG4gIH0sXG5cbiAgY29tcHV0ZWQ6IHtcbiAgICBwYXJzZWRGaXJzdEludGVydmFsICgpOiBudW1iZXIge1xuICAgICAgcmV0dXJuIHBhcnNlSW50KHRoaXMuZmlyc3RJbnRlcnZhbClcbiAgICB9LFxuICAgIHBhcnNlZEludGVydmFsTWludXRlcyAoKTogbnVtYmVyIHtcbiAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLmludGVydmFsTWludXRlcylcbiAgICB9LFxuICAgIHBhcnNlZEludGVydmFsQ291bnQgKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5pbnRlcnZhbENvdW50KVxuICAgIH0sXG4gICAgcGFyc2VkSW50ZXJ2YWxIZWlnaHQgKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gcGFyc2VGbG9hdCh0aGlzLmludGVydmFsSGVpZ2h0KVxuICAgIH0sXG4gICAgZmlyc3RNaW51dGUgKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZWRGaXJzdEludGVydmFsICogdGhpcy5wYXJzZWRJbnRlcnZhbE1pbnV0ZXNcbiAgICB9LFxuICAgIGJvZHlIZWlnaHQgKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZWRJbnRlcnZhbENvdW50ICogdGhpcy5wYXJzZWRJbnRlcnZhbEhlaWdodFxuICAgIH0sXG4gICAgZGF5cyAoKTogVlRpbWVzdGFtcFtdIHtcbiAgICAgIHJldHVybiBjcmVhdGVEYXlMaXN0KFxuICAgICAgICB0aGlzLnBhcnNlZFN0YXJ0LFxuICAgICAgICB0aGlzLnBhcnNlZEVuZCxcbiAgICAgICAgdGhpcy50aW1lcy50b2RheSxcbiAgICAgICAgdGhpcy53ZWVrZGF5U2tpcHMsXG4gICAgICAgIHRoaXMubWF4RGF5c1xuICAgICAgKVxuICAgIH0sXG4gICAgaW50ZXJ2YWxzICgpOiBWVGltZXN0YW1wW11bXSB7XG4gICAgICBjb25zdCBkYXlzOiBWVGltZXN0YW1wW10gPSB0aGlzLmRheXNcbiAgICAgIGNvbnN0IGZpcnN0OiBudW1iZXIgPSB0aGlzLnBhcnNlZEZpcnN0SW50ZXJ2YWxcbiAgICAgIGNvbnN0IG1pbnV0ZXM6IG51bWJlciA9IHRoaXMucGFyc2VkSW50ZXJ2YWxNaW51dGVzXG4gICAgICBjb25zdCBjb3VudDogbnVtYmVyID0gdGhpcy5wYXJzZWRJbnRlcnZhbENvdW50XG4gICAgICBjb25zdCBub3c6IFZUaW1lc3RhbXAgPSB0aGlzLnRpbWVzLm5vd1xuXG4gICAgICByZXR1cm4gZGF5cy5tYXAoZCA9PiBjcmVhdGVJbnRlcnZhbExpc3QoZCwgZmlyc3QsIG1pbnV0ZXMsIGNvdW50LCBub3cpKVxuICAgIH0sXG4gICAgaW50ZXJ2YWxGb3JtYXR0ZXIgKCk6IFZUaW1lc3RhbXBGb3JtYXR0ZXI8c3RyaW5nPiB7XG4gICAgICBpZiAodGhpcy5pbnRlcnZhbEZvcm1hdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnRlcnZhbEZvcm1hdCBhcyBWVGltZXN0YW1wRm9ybWF0dGVyPHN0cmluZz5cbiAgICAgIH1cblxuICAgICAgY29uc3QgbG9uZ09wdGlvbnMgPSB7IHRpbWVab25lOiAnVVRDJywgaG91cjEyOiB0cnVlLCBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH1cbiAgICAgIGNvbnN0IHNob3J0T3B0aW9ucyA9IHsgdGltZVpvbmU6ICdVVEMnLCBob3VyMTI6IHRydWUsIGhvdXI6ICdudW1lcmljJywgbWludXRlOiAnMi1kaWdpdCcgfVxuICAgICAgY29uc3Qgc2hvcnRIb3VyT3B0aW9ucyA9IHsgdGltZVpvbmU6ICdVVEMnLCBob3VyMTI6IHRydWUsIGhvdXI6ICdudW1lcmljJyB9XG5cbiAgICAgIHJldHVybiBjcmVhdGVOYXRpdmVMb2NhbGVGb3JtYXR0ZXIoXG4gICAgICAgIHRoaXMubG9jYWxlLFxuICAgICAgICAodG1zLCBzaG9ydCkgPT4gc2hvcnQgPyAodG1zLm1pbnV0ZSA9PT0gMCA/IHNob3J0SG91ck9wdGlvbnMgOiBzaG9ydE9wdGlvbnMpIDogbG9uZ09wdGlvbnNcbiAgICAgIClcbiAgICB9XG4gIH0sXG5cbiAgbWV0aG9kczoge1xuICAgIHNob3dJbnRlcnZhbExhYmVsRGVmYXVsdCAoaW50ZXJ2YWw6IFZUaW1lc3RhbXApOiBib29sZWFuIHtcbiAgICAgIGNvbnN0IGZpcnN0OiBWVGltZXN0YW1wID0gdGhpcy5pbnRlcnZhbHNbMF1bMF1cbiAgICAgIGNvbnN0IGlzRmlyc3Q6IGJvb2xlYW4gPSBmaXJzdC5ob3VyID09PSBpbnRlcnZhbC5ob3VyICYmIGZpcnN0Lm1pbnV0ZSA9PT0gaW50ZXJ2YWwubWludXRlXG4gICAgICByZXR1cm4gIWlzRmlyc3QgJiYgaW50ZXJ2YWwubWludXRlID09PSAwXG4gICAgfSxcbiAgICBpbnRlcnZhbFN0eWxlRGVmYXVsdCAoaW50ZXJ2YWw6IFZUaW1lc3RhbXApOiBvYmplY3QgfCB1bmRlZmluZWQge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH0sXG4gICAgZ2V0VGltZXN0YW1wQXRFdmVudCAoZTogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQsIGRheTogVlRpbWVzdGFtcCk6IFZUaW1lc3RhbXAge1xuICAgICAgY29uc3QgdGltZXN0YW1wOiBWVGltZXN0YW1wID0gY29weVRpbWVzdGFtcChkYXkpXG4gICAgICBjb25zdCBib3VuZHMgPSAoZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxFbGVtZW50KS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgICAgY29uc3QgYmFzZU1pbnV0ZXM6IG51bWJlciA9IHRoaXMuZmlyc3RNaW51dGVcbiAgICAgIGNvbnN0IHRvdWNoRXZlbnQ6IFRvdWNoRXZlbnQgPSBlIGFzIFRvdWNoRXZlbnRcbiAgICAgIGNvbnN0IG1vdXNlRXZlbnQ6IE1vdXNlRXZlbnQgPSBlIGFzIE1vdXNlRXZlbnRcbiAgICAgIGNvbnN0IHRvdWNoZXM6IFRvdWNoTGlzdCA9IHRvdWNoRXZlbnQuY2hhbmdlZFRvdWNoZXMgfHwgdG91Y2hFdmVudC50b3VjaGVzXG4gICAgICBjb25zdCBjbGllbnRZOiBudW1iZXIgPSB0b3VjaGVzICYmIHRvdWNoZXNbMF0gPyB0b3VjaGVzWzBdLmNsaWVudFkgOiBtb3VzZUV2ZW50LmNsaWVudFlcbiAgICAgIGNvbnN0IGFkZEludGVydmFsczogbnVtYmVyID0gKGNsaWVudFkgLSBib3VuZHMudG9wKSAvIHRoaXMucGFyc2VkSW50ZXJ2YWxIZWlnaHRcbiAgICAgIGNvbnN0IGFkZE1pbnV0ZXM6IG51bWJlciA9IE1hdGguZmxvb3IoYWRkSW50ZXJ2YWxzICogdGhpcy5wYXJzZWRJbnRlcnZhbE1pbnV0ZXMpXG4gICAgICBjb25zdCBtaW51dGVzOiBudW1iZXIgPSBiYXNlTWludXRlcyArIGFkZE1pbnV0ZXNcblxuICAgICAgcmV0dXJuIHVwZGF0ZU1pbnV0ZXModGltZXN0YW1wLCBtaW51dGVzLCB0aGlzLnRpbWVzLm5vdylcbiAgICB9XG4gIH1cbn0pXG4iXX0=