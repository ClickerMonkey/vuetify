import '../../stylus/components/_time-picker-clock.styl';
// Mixins
import Colorable from '../../mixins/colorable';
import Themeable from '../../mixins/themeable';
/* @vue/component */
export default {
    name: 'v-time-picker-clock',
    mixins: [
        Colorable,
        Themeable
    ],
    props: {
        allowedValues: Function,
        double: Boolean,
        format: {
            type: Function,
            default: val => val
        },
        max: {
            type: Number,
            required: true
        },
        min: {
            type: Number,
            required: true
        },
        scrollable: Boolean,
        rotate: {
            type: Number,
            default: 0
        },
        size: {
            type: [Number, String],
            default: 270
        },
        step: {
            type: Number,
            default: 1
        },
        value: Number
    },
    data() {
        return {
            defaultColor: 'accent',
            inputValue: this.value,
            isDragging: false,
            valueOnMouseDown: null,
            valueOnMouseUp: null
        };
    },
    computed: {
        count() {
            return this.max - this.min + 1;
        },
        innerRadius() {
            return this.radius - Math.max(this.radius * 0.4, 48);
        },
        outerRadius() {
            return this.radius - 4;
        },
        roundCount() {
            return this.double ? (this.count / 2) : this.count;
        },
        degreesPerUnit() {
            return 360 / this.roundCount;
        },
        degrees() {
            return this.degreesPerUnit * Math.PI / 180;
        },
        radius() {
            return this.size / 2;
        },
        displayedValue() {
            return this.value == null ? this.min : this.value;
        }
    },
    watch: {
        value(value) {
            this.inputValue = value;
        }
    },
    methods: {
        wheel(e) {
            e.preventDefault();
            const delta = Math.sign(e.wheelDelta || 1);
            let value = this.displayedValue;
            do {
                value = value + delta;
                value = (value - this.min + this.count) % this.count + this.min;
            } while (!this.isAllowed(value) && value !== this.displayedValue);
            if (value !== this.displayedValue) {
                this.update(value);
            }
        },
        handScale(value) {
            return this.double && (value - this.min >= this.roundCount) ? (this.innerRadius / this.radius) : (this.outerRadius / this.radius);
        },
        isAllowed(value) {
            return !this.allowedValues || this.allowedValues(value);
        },
        genValues() {
            const children = [];
            for (let value = this.min; value <= this.max; value = value + this.step) {
                const classes = {
                    active: value === this.displayedValue,
                    disabled: !this.isAllowed(value)
                };
                children.push(this.$createElement('span', {
                    'class': this.addBackgroundColorClassChecks(classes, value === this.value ? this.computedColor : null),
                    style: this.getTransform(value),
                    domProps: { innerHTML: `<span>${this.format(value)}</span>` }
                }));
            }
            return children;
        },
        genHand() {
            const scale = `scaleY(${this.handScale(this.displayedValue)})`;
            const angle = this.rotate + this.degreesPerUnit * (this.displayedValue - this.min);
            return this.$createElement('div', {
                staticClass: 'v-time-picker-clock__hand',
                'class': this.value == null ? {} : this.addBackgroundColorClassChecks(),
                style: {
                    transform: `rotate(${angle}deg) ${scale}`
                }
            });
        },
        getTransform(i) {
            const { x, y } = this.getPosition(i);
            return { transform: `translate(${x}px, ${y}px)` };
        },
        getPosition(value) {
            const radius = (this.radius - 24) * this.handScale(value);
            const rotateRadians = this.rotate * Math.PI / 180;
            return {
                x: Math.round(Math.sin((value - this.min) * this.degrees + rotateRadians) * radius),
                y: Math.round(-Math.cos((value - this.min) * this.degrees + rotateRadians) * radius)
            };
        },
        onMouseDown(e) {
            e.preventDefault();
            this.valueOnMouseDown = null;
            this.valueOnMouseUp = null;
            this.isDragging = true;
            this.onDragMove(e);
        },
        onMouseUp() {
            this.isDragging = false;
            if (this.valueOnMouseUp !== null && this.isAllowed(this.valueOnMouseUp)) {
                this.$emit('change', this.valueOnMouseUp);
            }
        },
        onDragMove(e) {
            e.preventDefault();
            if (!this.isDragging && e.type !== 'click')
                return;
            const { width, top, left } = this.$refs.clock.getBoundingClientRect();
            const { clientX, clientY } = 'touches' in e ? e.touches[0] : e;
            const center = { x: width / 2, y: -width / 2 };
            const coords = { x: clientX - left, y: top - clientY };
            const handAngle = Math.round(this.angle(center, coords) - this.rotate + 360) % 360;
            const insideClick = this.double && this.euclidean(center, coords) < (this.outerRadius + this.innerRadius) / 2 - 16;
            const value = Math.round(handAngle / this.degreesPerUnit) +
                this.min + (insideClick ? this.roundCount : 0);
            // Necessary to fix edge case when selecting left part of max value
            let newValue;
            if (handAngle >= (360 - this.degreesPerUnit / 2)) {
                newValue = insideClick ? this.max : this.min;
            }
            else {
                newValue = value;
            }
            if (this.isAllowed(value)) {
                if (this.valueOnMouseDown === null) {
                    this.valueOnMouseDown = newValue;
                }
                this.valueOnMouseUp = newValue;
                this.update(newValue);
            }
        },
        update(value) {
            if (this.inputValue !== value) {
                this.inputValue = value;
                this.$emit('input', value);
            }
        },
        euclidean(p0, p1) {
            const dx = p1.x - p0.x;
            const dy = p1.y - p0.y;
            return Math.sqrt(dx * dx + dy * dy);
        },
        angle(center, p1) {
            const value = 2 * Math.atan2(p1.y - center.y - this.euclidean(center, p1), p1.x - center.x);
            return Math.abs(value * 180 / Math.PI);
        }
    },
    render() {
        const data = {
            staticClass: 'v-time-picker-clock',
            class: {
                'v-time-picker-clock--indeterminate': this.value == null,
                ...this.themeClasses
            },
            on: {
                mousedown: this.onMouseDown,
                mouseup: this.onMouseUp,
                mouseleave: () => (this.isDragging && this.onMouseUp()),
                touchstart: this.onMouseDown,
                touchend: this.onMouseUp,
                mousemove: this.onDragMove,
                touchmove: this.onDragMove
            },
            style: {
                height: `${this.size}px`,
                width: `${this.size}px`
            },
            ref: 'clock'
        };
        this.scrollable && (data.on.wheel = this.wheel);
        return this.$createElement('div', data, [
            this.genHand(),
            this.genValues()
        ]);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlRpbWVQaWNrZXJDbG9jay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZUaW1lUGlja2VyL1ZUaW1lUGlja2VyQ2xvY2suanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxpREFBaUQsQ0FBQTtBQUV4RCxTQUFTO0FBQ1QsT0FBTyxTQUFTLE1BQU0sd0JBQXdCLENBQUE7QUFDOUMsT0FBTyxTQUFTLE1BQU0sd0JBQXdCLENBQUE7QUFFOUMsb0JBQW9CO0FBQ3BCLGVBQWU7SUFDYixJQUFJLEVBQUUscUJBQXFCO0lBRTNCLE1BQU0sRUFBRTtRQUNOLFNBQVM7UUFDVCxTQUFTO0tBQ1Y7SUFFRCxLQUFLLEVBQUU7UUFDTCxhQUFhLEVBQUUsUUFBUTtRQUN2QixNQUFNLEVBQUUsT0FBTztRQUNmLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxRQUFRO1lBQ2QsT0FBTyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRztTQUNwQjtRQUNELEdBQUcsRUFBRTtZQUNILElBQUksRUFBRSxNQUFNO1lBQ1osUUFBUSxFQUFFLElBQUk7U0FDZjtRQUNELEdBQUcsRUFBRTtZQUNILElBQUksRUFBRSxNQUFNO1lBQ1osUUFBUSxFQUFFLElBQUk7U0FDZjtRQUNELFVBQVUsRUFBRSxPQUFPO1FBQ25CLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLENBQUM7U0FDWDtRQUNELElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7WUFDdEIsT0FBTyxFQUFFLEdBQUc7U0FDYjtRQUNELElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLENBQUM7U0FDWDtRQUNELEtBQUssRUFBRSxNQUFNO0tBQ2Q7SUFFRCxJQUFJO1FBQ0YsT0FBTztZQUNMLFlBQVksRUFBRSxRQUFRO1lBQ3RCLFVBQVUsRUFBRSxJQUFJ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LFNBQVMsRUFBRSxJQUFJLENBQUMsV0FBVztnQkFDM0IsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTO2dCQUN2QixVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDdkQsVUFBVSxFQUFFLElBQUksQ0FBQyxXQUFXO2dCQUM1QixRQUFRLEVBQUUsSUFBSSxDQUFDLFNBQVM7Z0JBQ3hCLFNBQVMsRUFBRSxJQUFJLENBQUMsVUFBVTtnQkFDMUIsU0FBUyxFQUFFLElBQUksQ0FBQyxVQUFVO2FBQzNCO1lBQ0QsS0FBSyxFQUFFO2dCQUNMLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLElBQUk7Z0JBQ3hCLEtBQUssRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLElBQUk7YUFDeEI7WUFDRCxHQUFHLEVBQUUsT0FBTztTQUNiLENBQUE7UUFFRCxJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBRS9DLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQ3RDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDZCxJQUFJLENBQUMsU0FBUyxFQUFFO1NBQ2pCLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDRixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICcuLi8uLi9zdHlsdXMvY29tcG9uZW50cy9fdGltZS1waWNrZXItY2xvY2suc3R5bCdcblxuLy8gTWl4aW5zXG5pbXBvcnQgQ29sb3JhYmxlIGZyb20gJy4uLy4uL21peGlucy9jb2xvcmFibGUnXG5pbXBvcnQgVGhlbWVhYmxlIGZyb20gJy4uLy4uL21peGlucy90aGVtZWFibGUnXG5cbi8qIEB2dWUvY29tcG9uZW50ICovXG5leHBvcnQgZGVmYXVsdCB7XG4gIG5hbWU6ICd2LXRpbWUtcGlja2VyLWNsb2NrJyxcblxuICBtaXhpbnM6IFtcbiAgICBDb2xvcmFibGUsXG4gICAgVGhlbWVhYmxlXG4gIF0sXG5cbiAgcHJvcHM6IHtcbiAgICBhbGxvd2VkVmFsdWVzOiBGdW5jdGlvbixcbiAgICBkb3VibGU6IEJvb2xlYW4sXG4gICAgZm9ybWF0OiB7XG4gICAgICB0eXBlOiBGdW5jdGlvbixcbiAgICAgIGRlZmF1bHQ6IHZhbCA9PiB2YWxcbiAgICB9LFxuICAgIG1heDoge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICB9LFxuICAgIG1pbjoge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICB9LFxuICAgIHNjcm9sbGFibGU6IEJvb2xlYW4sXG4gICAgcm90YXRlOiB7XG4gICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICBkZWZhdWx0OiAwXG4gICAgfSxcbiAgICBzaXplOiB7XG4gICAgICB0eXBlOiBbTnVtYmVyLCBTdHJpbmddLFxuICAgICAgZGVmYXVsdDogMjcwXG4gICAgfSxcbiAgICBzdGVwOiB7XG4gICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICBkZWZhdWx0OiAxXG4gICAgfSxcbiAgICB2YWx1ZTogTnVtYmVyXG4gIH0sXG5cbiAgZGF0YSAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRlZmF1bHRDb2xvcjogJ2FjY2VudCcsXG4gICAgICBpbnB1dFZhbHVlOiB0aGlzLnZhbHVlLFxuICAgICAgaXNEcmFnZ2luZzogZmFsc2UsXG4gICAgICB2YWx1ZU9uTW91c2VEb3duOiBudWxsLFxuICAgICAgdmFsdWVPbk1vdXNlVXA6IG51bGxcbiAgICB9XG4gIH0sXG5cbiAgY29tcHV0ZWQ6IHtcbiAgICBjb3VudCAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tYXggLSB0aGlzLm1pbiArIDFcbiAgICB9LFxuICAgIGlubmVyUmFkaXVzICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnJhZGl1cyAtIE1hdGgubWF4KHRoaXMucmFkaXVzICogMC40LCA0OClcbiAgICB9LFxuICAgIG91dGVyUmFkaXVzICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnJhZGl1cyAtIDRcbiAgICB9LFxuICAgIHJvdW5kQ291bnQgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZG91YmxlID8gKHRoaXMuY291bnQgLyAyKSA6IHRoaXMuY291bnRcbiAgICB9LFxuICAgIGRlZ3JlZXNQZXJVbml0ICgpIHtcbiAgICAgIHJldHVybiAzNjAgLyB0aGlzLnJvdW5kQ291bnRcbiAgICB9LFxuICAgIGRlZ3JlZXMgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZGVncmVlc1BlclVuaXQgKiBNYXRoLlBJIC8gMTgwXG4gICAgfSxcbiAgICByYWRpdXMgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2l6ZSAvIDJcbiAgICB9LFxuICAgIGRpc3BsYXllZFZhbHVlICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnZhbHVlID09IG51bGwgPyB0aGlzLm1pbiA6IHRoaXMudmFsdWVcbiAgICB9XG4gIH0sXG5cbiAgd2F0Y2g6IHtcbiAgICB2YWx1ZSAodmFsdWUpIHtcbiAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHZhbHVlXG4gICAgfVxuICB9LFxuXG4gIG1ldGhvZHM6IHtcbiAgICB3aGVlbCAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICAgIGNvbnN0IGRlbHRhID0gTWF0aC5zaWduKGUud2hlZWxEZWx0YSB8fCAxKVxuICAgICAgbGV0IHZhbHVlID0gdGhpcy5kaXNwbGF5ZWRWYWx1ZVxuICAgICAgZG8ge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlICsgZGVsdGFcbiAgICAgICAgdmFsdWUgPSAodmFsdWUgLSB0aGlzLm1pbiArIHRoaXMuY291bnQpICUgdGhpcy5jb3VudCArIHRoaXMubWluXG4gICAgICB9IHdoaWxlICghdGhpcy5pc0FsbG93ZWQodmFsdWUpICYmIHZhbHVlICE9PSB0aGlzLmRpc3BsYXllZFZhbHVlKVxuXG4gICAgICBpZiAodmFsdWUgIT09IHRoaXMuZGlzcGxheWVkVmFsdWUpIHtcbiAgICAgICAgdGhpcy51cGRhdGUodmFsdWUpXG4gICAgICB9XG4gICAgfSxcbiAgICBoYW5kU2NhbGUgKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdGhpcy5kb3VibGUgJiYgKHZhbHVlIC0gdGhpcy5taW4gPj0gdGhpcy5yb3VuZENvdW50KSA/ICh0aGlzLmlubmVyUmFkaXVzIC8gdGhpcy5yYWRpdXMpIDogKHRoaXMub3V0ZXJSYWRpdXMgLyB0aGlzLnJhZGl1cylcbiAgICB9LFxuICAgIGlzQWxsb3dlZCAodmFsdWUpIHtcbiAgICAgIHJldHVybiAhdGhpcy5hbGxvd2VkVmFsdWVzIHx8IHRoaXMuYWxsb3dlZFZhbHVlcyh2YWx1ZSlcbiAgICB9LFxuICAgIGdlblZhbHVlcyAoKSB7XG4gICAgICBjb25zdCBjaGlsZHJlbiA9IFtdXG5cbiAgICAgIGZvciAobGV0IHZhbHVlID0gdGhpcy5taW47IHZhbHVlIDw9IHRoaXMubWF4OyB2YWx1ZSA9IHZhbHVlICsgdGhpcy5zdGVwKSB7XG4gICAgICAgIGNvbnN0IGNsYXNzZXMgPSB7XG4gICAgICAgICAgYWN0aXZlOiB2YWx1ZSA9PT0gdGhpcy5kaXNwbGF5ZWRWYWx1ZSxcbiAgICAgICAgICBkaXNhYmxlZDogIXRoaXMuaXNBbGxvd2VkKHZhbHVlKVxuICAgICAgICB9XG5cbiAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLiRjcmVhdGVFbGVtZW50KCdzcGFuJywge1xuICAgICAgICAgICdjbGFzcyc6IHRoaXMuYWRkQmFja2dyb3VuZENvbG9yQ2xhc3NDaGVja3MoY2xhc3NlcywgdmFsdWUgPT09IHRoaXMudmFsdWUgPyB0aGlzLmNvbXB1dGVkQ29sb3IgOiBudWxsKSxcbiAgICAgICAgICBzdHlsZTogdGhpcy5nZXRUcmFuc2Zvcm0odmFsdWUpLFxuICAgICAgICAgIGRvbVByb3BzOiB7IGlubmVySFRNTDogYDxzcGFuPiR7dGhpcy5mb3JtYXQodmFsdWUpfTwvc3Bhbj5gIH1cbiAgICAgICAgfSkpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjaGlsZHJlblxuICAgIH0sXG4gICAgZ2VuSGFuZCAoKSB7XG4gICAgICBjb25zdCBzY2FsZSA9IGBzY2FsZVkoJHt0aGlzLmhhbmRTY2FsZSh0aGlzLmRpc3BsYXllZFZhbHVlKX0pYFxuICAgICAgY29uc3QgYW5nbGUgPSB0aGlzLnJvdGF0ZSArIHRoaXMuZGVncmVlc1BlclVuaXQgKiAodGhpcy5kaXNwbGF5ZWRWYWx1ZSAtIHRoaXMubWluKVxuXG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICBzdGF0aWNDbGFzczogJ3YtdGltZS1waWNrZXItY2xvY2tfX2hhbmQnLFxuICAgICAgICAnY2xhc3MnOiB0aGlzLnZhbHVlID09IG51bGwgPyB7fSA6IHRoaXMuYWRkQmFja2dyb3VuZENvbG9yQ2xhc3NDaGVja3MoKSxcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICB0cmFuc2Zvcm06IGByb3RhdGUoJHthbmdsZX1kZWcpICR7c2NhbGV9YFxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sXG4gICAgZ2V0VHJhbnNmb3JtIChpKSB7XG4gICAgICBjb25zdCB7IHgsIHkgfSA9IHRoaXMuZ2V0UG9zaXRpb24oaSlcbiAgICAgIHJldHVybiB7IHRyYW5zZm9ybTogYHRyYW5zbGF0ZSgke3h9cHgsICR7eX1weClgIH1cbiAgICB9LFxuICAgIGdldFBvc2l0aW9uICh2YWx1ZSkge1xuICAgICAgY29uc3QgcmFkaXVzID0gKHRoaXMucmFkaXVzIC0gMjQpICogdGhpcy5oYW5kU2NhbGUodmFsdWUpXG4gICAgICBjb25zdCByb3RhdGVSYWRpYW5zID0gdGhpcy5yb3RhdGUgKiBNYXRoLlBJIC8gMTgwXG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiBNYXRoLnJvdW5kKE1hdGguc2luKCh2YWx1ZSAtIHRoaXMubWluKSAqIHRoaXMuZGVncmVlcyArIHJvdGF0ZVJhZGlhbnMpICogcmFkaXVzKSxcbiAgICAgICAgeTogTWF0aC5yb3VuZCgtTWF0aC5jb3MoKHZhbHVlIC0gdGhpcy5taW4pICogdGhpcy5kZWdyZWVzICsgcm90YXRlUmFkaWFucykgKiByYWRpdXMpXG4gICAgICB9XG4gICAgfSxcbiAgICBvbk1vdXNlRG93biAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICAgIHRoaXMudmFsdWVPbk1vdXNlRG93biA9IG51bGxcbiAgICAgIHRoaXMudmFsdWVPbk1vdXNlVXAgPSBudWxsXG4gICAgICB0aGlzLmlzRHJhZ2dpbmcgPSB0cnVlXG4gICAgICB0aGlzLm9uRHJhZ01vdmUoZSlcbiAgICB9LFxuICAgIG9uTW91c2VVcCAoKSB7XG4gICAgICB0aGlzLmlzRHJhZ2dpbmcgPSBmYWxzZVxuICAgICAgaWYgKHRoaXMudmFsdWVPbk1vdXNlVXAgIT09IG51bGwgJiYgdGhpcy5pc0FsbG93ZWQodGhpcy52YWx1ZU9uTW91c2VVcCkpIHtcbiAgICAgICAgdGhpcy4kZW1pdCgnY2hhbmdlJywgdGhpcy52YWx1ZU9uTW91c2VVcClcbiAgICAgIH1cbiAgICB9LFxuICAgIG9uRHJhZ01vdmUgKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgaWYgKCF0aGlzLmlzRHJhZ2dpbmcgJiYgZS50eXBlICE9PSAnY2xpY2snKSByZXR1cm5cblxuICAgICAgY29uc3QgeyB3aWR0aCwgdG9wLCBsZWZ0IH0gPSB0aGlzLiRyZWZzLmNsb2NrLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICBjb25zdCB7IGNsaWVudFgsIGNsaWVudFkgfSA9ICd0b3VjaGVzJyBpbiBlID8gZS50b3VjaGVzWzBdIDogZVxuICAgICAgY29uc3QgY2VudGVyID0geyB4OiB3aWR0aCAvIDIsIHk6IC13aWR0aCAvIDIgfVxuICAgICAgY29uc3QgY29vcmRzID0geyB4OiBjbGllbnRYIC0gbGVmdCwgeTogdG9wIC0gY2xpZW50WSB9XG4gICAgICBjb25zdCBoYW5kQW5nbGUgPSBNYXRoLnJvdW5kKHRoaXMuYW5nbGUoY2VudGVyLCBjb29yZHMpIC0gdGhpcy5yb3RhdGUgKyAzNjApICUgMzYwXG4gICAgICBjb25zdCBpbnNpZGVDbGljayA9IHRoaXMuZG91YmxlICYmIHRoaXMuZXVjbGlkZWFuKGNlbnRlciwgY29vcmRzKSA8ICh0aGlzLm91dGVyUmFkaXVzICsgdGhpcy5pbm5lclJhZGl1cykgLyAyIC0gMTZcbiAgICAgIGNvbnN0IHZhbHVlID0gTWF0aC5yb3VuZChoYW5kQW5nbGUgLyB0aGlzLmRlZ3JlZXNQZXJVbml0KSArXG4gICAgICAgIHRoaXMubWluICsgKGluc2lkZUNsaWNrID8gdGhpcy5yb3VuZENvdW50IDogMClcblxuICAgICAgLy8gTmVjZXNzYXJ5IHRvIGZpeCBlZGdlIGNhc2Ugd2hlbiBzZWxlY3RpbmcgbGVmdCBwYXJ0IG9mIG1heCB2YWx1ZVxuICAgICAgbGV0IG5ld1ZhbHVlXG4gICAgICBpZiAoaGFuZEFuZ2xlID49ICgzNjAgLSB0aGlzLmRlZ3JlZXNQZXJVbml0IC8gMikpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBpbnNpZGVDbGljayA/IHRoaXMubWF4IDogdGhpcy5taW5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld1ZhbHVlID0gdmFsdWVcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuaXNBbGxvd2VkKHZhbHVlKSkge1xuICAgICAgICBpZiAodGhpcy52YWx1ZU9uTW91c2VEb3duID09PSBudWxsKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZU9uTW91c2VEb3duID0gbmV3VmFsdWVcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZhbHVlT25Nb3VzZVVwID0gbmV3VmFsdWVcbiAgICAgICAgdGhpcy51cGRhdGUobmV3VmFsdWUpXG4gICAgICB9XG4gICAgfSxcbiAgICB1cGRhdGUgKHZhbHVlKSB7XG4gICAgICBpZiAodGhpcy5pbnB1dFZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgICB0aGlzLmlucHV0VmFsdWUgPSB2YWx1ZVxuICAgICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHZhbHVlKVxuICAgICAgfVxuICAgIH0sXG4gICAgZXVjbGlkZWFuIChwMCwgcDEpIHtcbiAgICAgIGNvbnN0IGR4ID0gcDEueCAtIHAwLnhcbiAgICAgIGNvbnN0IGR5ID0gcDEueSAtIHAwLnlcblxuICAgICAgcmV0dXJuIE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSlcbiAgICB9LFxuICAgIGFuZ2xlIChjZW50ZXIsIHAxKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IDIgKiBNYXRoLmF0YW4yKHAxLnkgLSBjZW50ZXIueSAtIHRoaXMuZXVjbGlkZWFuKGNlbnRlciwgcDEpLCBwMS54IC0gY2VudGVyLngpXG4gICAgICByZXR1cm4gTWF0aC5hYnModmFsdWUgKiAxODAgLyBNYXRoLlBJKVxuICAgIH1cbiAgfSxcblxuICByZW5kZXIgKCkge1xuICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICBzdGF0aWNDbGFzczogJ3YtdGltZS1waWNrZXItY2xvY2snLFxuICAgICAgY2xhc3M6IHtcbiAgICAgICAgJ3YtdGltZS1waWNrZXItY2xvY2stLWluZGV0ZXJtaW5hdGUnOiB0aGlzLnZhbHVlID09IG51bGwsXG4gICAgICAgIC4uLnRoaXMudGhlbWVDbGFzc2VzXG4gICAgICB9LFxuICAgICAgb246IHtcbiAgICAgICAgbW91c2Vkb3duOiB0aGlzLm9uTW91c2VEb3duLFxuICAgICAgICBtb3VzZXVwOiB0aGlzLm9uTW91c2VVcCxcbiAgICAgICAgbW91c2VsZWF2ZTogKCkgPT4gKHRoaXMuaXNEcmFnZ2luZyAmJiB0aGlzLm9uTW91c2VVcCgpKSxcbiAgICAgICAgdG91Y2hzdGFydDogdGhpcy5vbk1vdXNlRG93bixcbiAgICAgICAgdG91Y2hlbmQ6IHRoaXMub25Nb3VzZVVwLFxuICAgICAgICBtb3VzZW1vdmU6IHRoaXMub25EcmFnTW92ZSxcbiAgICAgICAgdG91Y2htb3ZlOiB0aGlzLm9uRHJhZ01vdmVcbiAgICAgIH0sXG4gICAgICBzdHlsZToge1xuICAgICAgICBoZWlnaHQ6IGAke3RoaXMuc2l6ZX1weGAsXG4gICAgICAgIHdpZHRoOiBgJHt0aGlzLnNpemV9cHhgXG4gICAgICB9LFxuICAgICAgcmVmOiAnY2xvY2snXG4gICAgfVxuXG4gICAgdGhpcy5zY3JvbGxhYmxlICYmIChkYXRhLm9uLndoZWVsID0gdGhpcy53aGVlbClcblxuICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCdkaXYnLCBkYXRhLCBbXG4gICAgICB0aGlzLmdlbkhhbmQoKSxcbiAgICAgIHRoaXMuZ2VuVmFsdWVzKClcbiAgICBdKVxuICB9XG59XG4iXX0=