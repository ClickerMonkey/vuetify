import '../../stylus/components/_pagination.styl';
import VIcon from '../VIcon';
import Resize from '../../directives/resize';
import Colorable from '../../mixins/colorable';
/* @vue/component */
export default {
    name: 'v-pagination',
    directives: { Resize },
    mixins: [Colorable],
    props: {
        circle: Boolean,
        disabled: Boolean,
        length: {
            type: Number,
            default: 0,
            validator: val => val % 1 === 0
        },
        totalVisible: [Number, String],
        nextIcon: {
            type: String,
            default: '$vuetify.icons.next'
        },
        prevIcon: {
            type: String,
            default: '$vuetify.icons.prev'
        },
        value: {
            type: Number,
            default: 0
        }
    },
    data() {
        return {
            maxButtons: 0,
            defaultColor: 'primary'
        };
    },
    computed: {
        classes() {
            return {
                'v-pagination': true,
                'v-pagination--circle': this.circle,
                'v-pagination--disabled': this.disabled
            };
        },
        items() {
            const maxLength = this.totalVisible || this.maxButtons;
            if (this.length <= maxLength) {
                return this.range(1, this.length);
            }
            const even = maxLength % 2 === 0 ? 1 : 0;
            const left = Math.floor(maxLength / 2);
            const right = this.length - left + 1 + even;
            if (this.value > left && this.value < right) {
                const start = this.value - left + 2;
                const end = this.value + left - 2 - even;
                return [1, '...', ...this.range(start, end), '...', this.length];
            }
            else {
                return [
                    ...this.range(1, left),
                    '...',
                    ...this.range(this.length - left + 1 + even, this.length)
                ];
            }
        }
    },
    watch: {
        value() {
            this.init();
        }
    },
    mounted() {
        this.init();
    },
    methods: {
        init() {
            this.selected = null;
            this.$nextTick(this.onResize);
            // TODO: Change this (f75dee3a, cbdf7caa)
            setTimeout(() => (this.selected = this.value), 100);
        },
        onResize() {
            const width = this.$el && this.$el.parentNode
                ? this.$el.parentNode.clientWidth
                : window.innerWidth;
            this.maxButtons = Math.floor((width - 96) / 42);
        },
        next(e) {
            e.preventDefault();
            this.$emit('input', this.value + 1);
            this.$emit('next');
        },
        previous(e) {
            e.preventDefault();
            this.$emit('input', this.value - 1);
            this.$emit('previous');
        },
        range(from, to) {
            const range = [];
            from = from > 0 ? from : 1;
            for (let i = from; i <= to; i++) {
                range.push(i);
            }
            return range;
        },
        genIcon(h, icon, disabled, fn) {
            return h('li', [
                h('button', {
                    staticClass: 'v-pagination__navigation',
                    class: {
                        'v-pagination__navigation--disabled': disabled
                    },
                    on: disabled ? {} : { click: fn }
                }, [h(VIcon, [icon])])
            ]);
        },
        genItem(h, i) {
            return h('button', {
                staticClass: 'v-pagination__item',
                class: (i === this.value) ? this.addBackgroundColorClassChecks({
                    'v-pagination__item--active': true
                }) : {},
                on: {
                    click: () => this.$emit('input', i)
                }
            }, [i]);
        },
        genItems(h) {
            return this.items.map((i, index) => {
                return h('li', { key: index }, [
                    isNaN(i) ? h('span', { class: 'v-pagination__more' }, [i]) : this.genItem(h, i)
                ]);
            });
        }
    },
    render(h) {
        const children = [
            this.genIcon(h, this.$vuetify.rtl ? this.nextIcon : this.prevIcon, this.value <= 1, this.previous),
            this.genItems(h),
            this.genIcon(h, this.$vuetify.rtl ? this.prevIcon : this.nextIcon, this.value >= this.length, this.next)
        ];
        return h('ul', {
            directives: [{
                    modifiers: { quiet: true },
                    name: 'resize',
                    value: this.onResize
                }],
            class: this.classes
        }, children);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlBhZ2luYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WUGFnaW5hdGlvbi9WUGFnaW5hdGlvbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLDBDQUEwQyxDQUFBO0FBRWpELE9BQU8sS0FBSyxNQUFNLFVBQVUsQ0FBQTtBQUU1QixPQUFPLE1BQU0sTUFBTSx5QkFBeUIsQ0FBQTtBQUU1QyxPQUFPLFNBQVMsTUFBTSx3QkFBd0IsQ0FBQTtBQUU5QyxvQkFBb0I7QUFDcEIsZUFBZTtJQUNiLElBQUksRUFBRSxjQUFjO0lBRXBCLFVBQVUsRUFBRSxFQUFFLE1BQU0sRUFBRTtJQUV0QixNQUFNLEVBQUUsQ0FBQyxTQUFTLENBQUM7SUFFbkIsS0FBSyxFQUFFO1FBQ0wsTUFBTSxFQUFFLE9BQU87UUFDZixRQUFRLEVBQUUsT0FBTztRQUNqQixNQUFNLEVBQUU7WUFDTixJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxDQUFDO1lBQ1YsU0FBUyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO1NBQ2hDO1FBQ0QsWUFBWSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztRQUM5QixRQUFRLEVBQUU7WUFDUixJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxxQkFBcUI7U0FDL0I7UUFDRCxRQUFRLEVBQUU7WUFDUixJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxxQkFBcUI7U0FDL0I7UUFDRCxLQUFLLEVBQUU7WUFDTCxJQUFJLEVBQUUsTUFBTTtZQUNaLE9BQU8sRUFBRSxDQUFDO1NBQ1g7S0FDRjtJQUVELElBQUk7UUFDRixPQUFPO1lBQ0wsVUFBVSxFQUFFLENBQUM7WUFDYixZQUFZLEVBQUUsU0FBUztTQUN4QixDQUFBO0lBQ0gsQ0FBQztJQUVELFFBQVEsRUFBRTtRQUNSLE9BQU87WUFDTCxPQUFPO2dCQUNMLGNB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QUMsUUFBUSxDQUFDO1lBQ2xHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ2hCLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQ3pHLENBQUE7UUFFRCxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUU7WUFDYixVQUFVLEVBQUUsQ0FBQztvQkFDWCxTQUFTLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO29CQUMxQixJQUFJLEVBQUUsUUFBUTtvQkFDZCxLQUFLLEVBQUUsSUFBSSxDQUFDLFFBQVE7aUJBQ3JCLENBQUM7WUFDRixLQUFLLEVBQUUsSUFBSSxDQUFDLE9BQU87U0FDcEIsRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUNkLENBQUM7Q0FDRixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICcuLi8uLi9zdHlsdXMvY29tcG9uZW50cy9fcGFnaW5hdGlvbi5zdHlsJ1xuXG5pbXBvcnQgVkljb24gZnJvbSAnLi4vVkljb24nXG5cbmltcG9ydCBSZXNpemUgZnJvbSAnLi4vLi4vZGlyZWN0aXZlcy9yZXNpemUnXG5cbmltcG9ydCBDb2xvcmFibGUgZnJvbSAnLi4vLi4vbWl4aW5zL2NvbG9yYWJsZSdcblxuLyogQHZ1ZS9jb21wb25lbnQgKi9cbmV4cG9ydCBkZWZhdWx0IHtcbiAgbmFtZTogJ3YtcGFnaW5hdGlvbicsXG5cbiAgZGlyZWN0aXZlczogeyBSZXNpemUgfSxcblxuICBtaXhpbnM6IFtDb2xvcmFibGVdLFxuXG4gIHByb3BzOiB7XG4gICAgY2lyY2xlOiBCb29sZWFuLFxuICAgIGRpc2FibGVkOiBCb29sZWFuLFxuICAgIGxlbmd0aDoge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgZGVmYXVsdDogMCxcbiAgICAgIHZhbGlkYXRvcjogdmFsID0+IHZhbCAlIDEgPT09IDBcbiAgICB9LFxuICAgIHRvdGFsVmlzaWJsZTogW051bWJlciwgU3RyaW5nXSxcbiAgICBuZXh0SWNvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJyR2dWV0aWZ5Lmljb25zLm5leHQnXG4gICAgfSxcbiAgICBwcmV2SWNvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJyR2dWV0aWZ5Lmljb25zLnByZXYnXG4gICAgfSxcbiAgICB2YWx1ZToge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgZGVmYXVsdDogMFxuICAgIH1cbiAgfSxcblxuICBkYXRhICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbWF4QnV0dG9uczogMCxcbiAgICAgIGRlZmF1bHRDb2xvcjogJ3ByaW1hcnknXG4gICAgfVxuICB9LFxuXG4gIGNvbXB1dGVkOiB7XG4gICAgY2xhc3NlcyAoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAndi1wYWdpbmF0aW9uJzogdHJ1ZSxcbiAgICAgICAgJ3YtcGFnaW5hdGlvbi0tY2lyY2xlJzogdGhpcy5jaXJjbGUsXG4gICAgICAgICd2LXBhZ2luYXRpb24tLWRpc2FibGVkJzogdGhpcy5kaXNhYmxlZFxuICAgICAgfVxuICAgIH0sXG5cbiAgICBpdGVtcyAoKSB7XG4gICAgICBjb25zdCBtYXhMZW5ndGggPSB0aGlzLnRvdGFsVmlzaWJsZSB8fCB0aGlzLm1heEJ1dHRvbnNcbiAgICAgIGlmICh0aGlzLmxlbmd0aCA8PSBtYXhMZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmFuZ2UoMSwgdGhpcy5sZW5ndGgpXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGV2ZW4gPSBtYXhMZW5ndGggJSAyID09PSAwID8gMSA6IDBcbiAgICAgIGNvbnN0IGxlZnQgPSBNYXRoLmZsb29yKG1heExlbmd0aCAvIDIpXG4gICAgICBjb25zdCByaWdodCA9IHRoaXMubGVuZ3RoIC0gbGVmdCArIDEgKyBldmVuXG5cbiAgICAgIGlmICh0aGlzLnZhbHVlID4gbGVmdCAmJiB0aGlzLnZhbHVlIDwgcmlnaHQpIHtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLnZhbHVlIC0gbGVmdCArIDJcbiAgICAgICAgY29uc3QgZW5kID0gdGhpcy52YWx1ZSArIGxlZnQgLSAyIC0gZXZlblxuXG4gICAgICAgIHJldHVybiBbMSwgJy4uLicsIC4uLnRoaXMucmFuZ2Uoc3RhcnQsIGVuZCksICcuLi4nLCB0aGlzLmxlbmd0aF1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgLi4udGhpcy5yYW5nZSgxLCBsZWZ0KSxcbiAgICAgICAgICAnLi4uJyxcbiAgICAgICAgICAuLi50aGlzLnJhbmdlKHRoaXMubGVuZ3RoIC0gbGVmdCArIDEgKyBldmVuLCB0aGlzLmxlbmd0aClcbiAgICAgICAgXVxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICB3YXRjaDoge1xuICAgIHZhbHVlICgpIHtcbiAgICAgIHRoaXMuaW5pdCgpXG4gICAgfVxuICB9LFxuXG4gIG1vdW50ZWQgKCkge1xuICAgIHRoaXMuaW5pdCgpXG4gIH0sXG5cbiAgbWV0aG9kczoge1xuICAgIGluaXQgKCkge1xuICAgICAgdGhpcy5zZWxlY3RlZCA9IG51bGxcblxuICAgICAgdGhpcy4kbmV4dFRpY2sodGhpcy5vblJlc2l6ZSlcbiAgICAgIC8vIFRPRE86IENoYW5nZSB0aGlzIChmNzVkZWUzYSwgY2JkZjdjYWEpXG4gICAgICBzZXRUaW1lb3V0KCgpID0+ICh0aGlzLnNlbGVjdGVkID0gdGhpcy52YWx1ZSksIDEwMClcbiAgICB9LFxuICAgIG9uUmVzaXplICgpIHtcbiAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy4kZWwgJiYgdGhpcy4kZWwucGFyZW50Tm9kZVxuICAgICAgICA/IHRoaXMuJGVsLnBhcmVudE5vZGUuY2xpZW50V2lkdGhcbiAgICAgICAgOiB3aW5kb3cuaW5uZXJXaWR0aFxuXG4gICAgICB0aGlzLm1heEJ1dHRvbnMgPSBNYXRoLmZsb29yKCh3aWR0aCAtIDk2KSAvIDQyKVxuICAgIH0sXG4gICAgbmV4dCAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHRoaXMudmFsdWUgKyAxKVxuICAgICAgdGhpcy4kZW1pdCgnbmV4dCcpXG4gICAgfSxcbiAgICBwcmV2aW91cyAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHRoaXMudmFsdWUgLSAxKVxuICAgICAgdGhpcy4kZW1pdCgncHJldmlvdXMnKVxuICAgIH0sXG4gICAgcmFuZ2UgKGZyb20sIHRvKSB7XG4gICAgICBjb25zdCByYW5nZSA9IFtdXG5cbiAgICAgIGZyb20gPSBmcm9tID4gMCA/IGZyb20gOiAxXG5cbiAgICAgIGZvciAobGV0IGkgPSBmcm9tOyBpIDw9IHRvOyBpKyspIHtcbiAgICAgICAgcmFuZ2UucHVzaChpKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmFuZ2VcbiAgICB9LFxuICAgIGdlbkljb24gKGgsIGljb24sIGRpc2FibGVkLCBmbikge1xuICAgICAgcmV0dXJuIGgoJ2xpJywgW1xuICAgICAgICBoKCdidXR0b24nLCB7XG4gICAgICAgICAgc3RhdGljQ2xhc3M6ICd2LXBhZ2luYXRpb25fX25hdmlnYXRpb24nLFxuICAgICAgICAgIGNsYXNzOiB7XG4gICAgICAgICAgICAndi1wYWdpbmF0aW9uX19uYXZpZ2F0aW9uLS1kaXNhYmxlZCc6IGRpc2FibGVkXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvbjogZGlzYWJsZWQgPyB7fSA6IHsgY2xpY2s6IGZuIH1cbiAgICAgICAgfSwgW2goVkljb24sIFtpY29uXSldKVxuICAgICAgXSlcbiAgICB9LFxuICAgIGdlbkl0ZW0gKGgsIGkpIHtcbiAgICAgIHJldHVybiBoKCdidXR0b24nLCB7XG4gICAgICAgIHN0YXRpY0NsYXNzOiAndi1wYWdpbmF0aW9uX19pdGVtJyxcbiAgICAgICAgY2xhc3M6IChpID09PSB0aGlzLnZhbHVlKSA/IHRoaXMuYWRkQmFja2dyb3VuZENvbG9yQ2xhc3NDaGVja3Moe1xuICAgICAgICAgICd2LXBhZ2luYXRpb25fX2l0ZW0tLWFjdGl2ZSc6IHRydWVcbiAgICAgICAgfSkgOiB7fSxcbiAgICAgICAgb246IHtcbiAgICAgICAgICBjbGljazogKCkgPT4gdGhpcy4kZW1pdCgnaW5wdXQnLCBpKVxuICAgICAgICB9XG4gICAgICB9LCBbaV0pXG4gICAgfSxcbiAgICBnZW5JdGVtcyAoaCkge1xuICAgICAgcmV0dXJuIHRoaXMuaXRlbXMubWFwKChpLCBpbmRleCkgPT4ge1xuICAgICAgICByZXR1cm4gaCgnbGknLCB7IGtleTogaW5kZXggfSwgW1xuICAgICAgICAgIGlzTmFOKGkpID8gaCgnc3BhbicsIHsgY2xhc3M6ICd2LXBhZ2luYXRpb25fX21vcmUnIH0sIFtpXSkgOiB0aGlzLmdlbkl0ZW0oaCwgaSlcbiAgICAgICAgXSlcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIHJlbmRlciAoaCkge1xuICAgIGNvbnN0IGNoaWxkcmVuID0gW1xuICAgICAgdGhpcy5nZW5JY29uKGgsIHRoaXMuJHZ1ZXRpZnkucnRsID8gdGhpcy5uZXh0SWNvbiA6IHRoaXMucHJldkljb24sIHRoaXMudmFsdWUgPD0gMSwgdGhpcy5wcmV2aW91cyksXG4gICAgICB0aGlzLmdlbkl0ZW1zKGgpLFxuICAgICAgdGhpcy5nZW5JY29uKGgsIHRoaXMuJHZ1ZXRpZnkucnRsID8gdGhpcy5wcmV2SWNvbiA6IHRoaXMubmV4dEljb24sIHRoaXMudmFsdWUgPj0gdGhpcy5sZW5ndGgsIHRoaXMubmV4dClcbiAgICBdXG5cbiAgICByZXR1cm4gaCgndWwnLCB7XG4gICAgICBkaXJlY3RpdmVzOiBbe1xuICAgICAgICBtb2RpZmllcnM6IHsgcXVpZXQ6IHRydWUgfSxcbiAgICAgICAgbmFtZTogJ3Jlc2l6ZScsXG4gICAgICAgIHZhbHVlOiB0aGlzLm9uUmVzaXplXG4gICAgICB9XSxcbiAgICAgIGNsYXNzOiB0aGlzLmNsYXNzZXNcbiAgICB9LCBjaGlsZHJlbilcbiAgfVxufVxuIl19